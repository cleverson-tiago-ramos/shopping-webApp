name: CI/CD Monorepo

on:
  push:
    tags:
      - "api-v*"
      - "admin-v*"
      - "site-v*"

jobs:
  build-api:
    name: ğŸ“¡ API - NestJS
    if: startsWith(github.ref, 'refs/tags/api-v')
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: âš™ï¸ Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Instala dependÃªncias
        working-directory: apps/api
        run: npm ci

      - name: ğŸ—ï¸ Build da API
        working-directory: apps/api
        run: npm run build

      - name: ğŸ“¤ Deploy da API (simulado)
        run: echo "âœ… Deploy da API via tag concluÃ­do!"

  build-admin:
    name: ğŸ› ï¸ Admin - Painel Next.js
    if: startsWith(github.ref, 'refs/tags/admin-v')
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: âš™ï¸ Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Instala dependÃªncias
        working-directory: apps/admin
        run: npm ci

      - name: ğŸ—ï¸ Build do Admin
        working-directory: apps/admin
        run: npm run build

      - name: ğŸ“¤ Deploy do Admin via tag
        run: echo "âœ… Deploy do Painel via tag concluÃ­do!"

  build-site:
    name: ğŸŒ Site - Next.js
    if: startsWith(github.ref, 'refs/tags/site-v')
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: âš™ï¸ Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Instala dependÃªncias
        working-directory: apps/site
        run: npm ci

      - name: ğŸ—ï¸ Build do Site
        working-directory: apps/site
        run: npm run build

      - name: ğŸ“¤ Deploy do Site via tag
        run: echo "âœ… Deploy do Site via tag concluÃ­do!"
