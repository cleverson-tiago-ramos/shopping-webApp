name: CI/CD Monorepo

on:
  push:
    branches:
      - main
    paths:
      - "apps/**"
      - "config/**"

jobs:
  build-api:
    name: ğŸ“¡ API - NestJS
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, 'apps/api') || contains(github.event.head_commit.message, 'config')
    steps:
      - name: â¬‡ï¸ Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: âš™ï¸ Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Instala dependÃªncias
        working-directory: apps/api
        run: npm ci

      - name: ğŸ—ï¸ Build da API
        working-directory: apps/api
        run: npm run build

      - name: ğŸ“¤ Deploy da API (simulado)
        run: echo "âœ… Deploy da API concluÃ­do!"

  build-admin:
    name: ğŸ› ï¸ Admin - Painel Next.js
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, 'apps/admin') || contains(github.event.head_commit.message, 'config')
    steps:
      - name: â¬‡ï¸ Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: âš™ï¸ Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Instala dependÃªncias
        working-directory: apps/admin
        run: npm ci

      - name: ğŸ—ï¸ Build do Admin
        working-directory: apps/admin
        run: npm run build

      - name: ğŸ“¤ Deploy do Admin (simulado)
        run: echo "âœ… Deploy do Painel concluÃ­do!"

  build-site:
    name: ğŸŒ Site - Next.js
    runs-on: ubuntu-latest
    if: contains(github.event.head_commit.message, 'apps/site') || contains(github.event.head_commit.message, 'config')
    steps:
      - name: â¬‡ï¸ Checkout do cÃ³digo
        uses: actions/checkout@v3

      - name: âš™ï¸ Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Instala dependÃªncias
        working-directory: apps/site
        run: npm ci

      - name: ğŸ—ï¸ Build do Site
        working-directory: apps/site
        run: npm run build

      - name: ğŸ“¤ Deploy do Site (simulado)
        run: echo "âœ… Deploy do Site concluÃ­do!"
